#require File.expand_path('simple', File.dirname(__FILE__))

require 'zlib'
require 'stringio'


# Write a gzip file of data
def zip(data, file)
  File.open(file, 'w+') do |f|
    gz_writer = Zlib::GzipWriter.new(f)
    gz_writer.orig_name=('test.i')
    gz_writer.write(data)
    gz_writer.close
  end
end

# Read a gzip file and return the contents
def unzip(file)
  new_data = ''
  File.open(file, 'r') do |f|
    gz_reader = Zlib::GzipReader.new(f)
    new_data = gz_reader.read
    gz_reader.close
  end
  new_data
end

# A simple round-trip test through the file system
original = "Some test data."
filename = 'test.gz'
zip(original, filename)
f = File.open(filename, 'r')
gz_reader = Zlib::GzipReader.new(f)
copy = gz_reader.read
orig_name = gz_reader.orig_name()
gz_reader.close

raise "Failed: #{copy}" unless copy == original
raise "Failed to write header: " unless orig_name == 'test.i'

# Test that MagLev can read a gzip file generated by MRI
# r = unzip('test-mri.gz')
# raise "Failed unzip of MRI file" unless r == original

# some_data = "Here is some data      with         spaces"
# zipper = Zlib::Deflate.new
# compressed = zipper.deflate(some_data, Zlib::FINISH)

# unzipper = Zlib::Inflate.new
# unzipper << compressed
# processed_data = unzipper.inflate(nil)
# puts "original:       #{some_data}"
# puts "processed_data: #{processed_data}"
# raise "Failed round trip" unless processed_data == some_data



# # A test using a file created by the Mac OS X gzip utility.

# data_dir = File.dirname(__FILE__) + '/test_data'
# orig_file = data_dir  + '/zlib_test_file'
# gz_file   = orig_file + '.gz'
# orig_data = File.read(orig_file)
# File.open(gz_file) do |f|
#   gzip = Zlib::GzipReader.new(f)
#   data = gzip.read
#   raise "Fail" unless data == orig_data
# end

# def deflate(a_string, level = Zlib::BEST_SPEED)
#   z = Zlib::Deflate.new(level)
#   compressed = z.deflate(a_string, Zlib::FINISH)
#   z.close
#   puts "deflate:  #{compressed.inspect}"
#   compressed
# end

# # Uncompress compressed_string and return it
# def inflate(compressed_string)
#   zstream = Zlib::Inflate.new
#   buf = zstream.inflate(compressed_string)
#   zstream.finish
#   zstream.close
#   puts "inflate:  #{buf.inspect}"
#   buf
# end

# original = "Hello Mom"
# compressed = deflate(original)
# uncompressed = inflate(compressed)
# raise "Not the same: original: #{original}  uncompressed: #{uncompressed}" unless uncompressed == original

#report
#true
