== Current state of various applications

This document summarizes the state of various applications under MagLev.
MagLev does not currently support the Ruby C-extension mechanism.  Features
of applications that depend on a C-extension do not work.

=== Rack

Version 0.9.1 of Rack is in <tt>src/external/Rack</tt>

MagLev does not currently support (at least) the following Rack features:
* openid
* mongrel
* memcache
* thin
* showexceptions (depends on erb)
* showstatus (depends on erb)
* cookies (depends on openssl)
* fastcgi

=== Sinatra

Version 0.9.0.4 of Sinatra is in <tt>src/external/Sinatra</tt>.   Much of
Sinatra runs, but some things don't.

The following items seem to work (at least in the simple case)
* Routes
* Source code reloading
* Views (erb)

The following items are known not to work:

* Cookies and Cookie based sessions
  WEBrick requires openssl for cookie support. openssl is a C-based
  library, and MagLev does not yet support ruby c-extensions.

==== GemStone Patches for Sinatra

GemStone has made the following modifications to the stock version of
Sinatra:

* lib/sinatra/main.rb: Stubbed out the definition of run.  The
  implementation depended on examining the stack frames returnd by
  Kernel#caller, but the details of filenames caused problems (MagLev
  prints only full pathnames, while MRI prints a variety of formats).

=== RubyGems

A slightly modified version of RubyGems is in the source tree under
src/external/rubygems-1.3.1.  MagLev will run the setup.rb file, as long as
you don't try to make the rdoc:

    $ cd src/external/rubygems-1.3.1
    $ mruby setup.rb --no-rdoc --no-ri

This will create the ruby gems hierarchy under lib/maglev/gems/... and will
create a bin/maglev-gem.  To clean up, there is a rake task:

    $ rake dev:clean-gems

Since bin/maglev-ruby is a shell script, and bin/maglev-gem is also a shell
script, there is a bit of confusion trying to invoke ruby gems the normal
way:

    $ maglev-gem --version
    /Users/pmclain/DevelopmentMagLev/git/bin/maglev-gem: line 8: require: command not found
    /Users/pmclain/DevelopmentMagLev/git/bin/maglev-gem: line 9: require: command not found
    ...

This is because the shell ends up trying to read the commands in
bin/maglev-gem as shell commands...

If you run maglev, and pass maglev-gem as the script, then you can invoke
some of the ruby gems commands:

    $ maglev-ruby bin/maglev-gem --version
    1.3.1

We have successfully installed the rake gem:

    $ maglev-ruby bin/maglev-gem install rake --no-rdoc --no-ri

But rake itself isn't working yet.

==== Gemstone Patches for RubyGems

GemStone has made the following modifications to the stock version of
RubyGems:

* lib/rubygems/package/tar_input.rb: The tar support throws away the gzip
  header before passing the archive to zlib.  MagLev's zlib support expects
  the gzip header (and, apparently, so does Rubinius).  So, we do not throw
  away the header before processing the archive:
* lib/rubygems/version.rb: A few of the Version objects are not initialized
  properly (@ints is nil).  This causes problems in <=>, so we normalize
  both sides before comparing @ints.
