== Current state of various applications

This document summarizes the state of various applications under MagLev.
MagLev does not currently support the Ruby C-extension mechanism.  Features
of applications that depend on a C-extension do not work.

=== Rack

An unmodified version 1.0.0 of Rack is in <tt>src/external/rack</tt>

MagLev does not currently support (at least) the following Rack features:
* openid
* mongrel
* memcache
* thin
* showexceptions (depends on erb)
* showstatus (depends on erb)
* cookies (depends on openssl)
* fastcgi

=== Sinatra

An unmodified version 0.9.3 of Sinatra is in
<tt>src/external/sinatra</tt>.
Much of Sinatra runs, but some things don't.

The following items seem to work (at least in the simple case)
* Routes
* Source code reloading
* Views (erb)

The following items are known not to work:

* Cookies and Cookie based sessions
  WEBrick requires openssl for cookie support. openssl is a C-based
  library, and MagLev does not yet support ruby c-extensions.

==== GemStone Patches for Sinatra

GemStone has made the following modifications to the stock version of
Sinatra:

* lib/sinatra/main.rb: Stubbed out the definition of run.  The
  implementation depended on examining the stack frames returnd by
  Kernel#caller, but the details of filenames caused problems (MagLev
  prints only full pathnames, while MRI prints a variety of formats).

=== RubyGems

A slightly modified version of RubyGems is in the source tree under
src/external/rubygems-1.3.5.  MagLev will run the setup.rb file, as long as
you don't try to make the rdoc:

    $ cd src/external/rubygems-1.3.5
    $ maglev-ruby setup.rb --no-rdoc --no-ri

This will create the RubyGems hierarchy under lib/maglev/gems/... and will
create a bin/maglev-gem. However, you'll need to change the first line in
bin/maglev-gem to:
    #!/usr/bin/env maglev-ruby
otherwise maglev-gem will act like a shell script rather than a ruby script --
causing this type of error:
    $ maglev-gem --version
    /Users/pmclain/DevelopmentMagLev/git/bin/maglev-gem: line 8: require: command not found
    /Users/pmclain/DevelopmentMagLev/git/bin/maglev-gem: line 9: require: command not found

Once you've tweaked <tt>bin/magelv-gem</tt> however, any shell scripts
installed using rubygems will have the appropriate shebang line.

We have succuessfully installed rack-1.0.0 and run a basic rack app using
rubygems (see <tt>examples/rack/gemrack.rb</tt>):

To clean up after experimenting with gems, there is a rake task:

    $ rake dev:clean-gems

which removes all traces of any gems you've installed.

==== Gemstone Patches for RubyGems

GemStone has made the following modifications to the stock version of
RubyGems 1.3.5:

* lib/rubygems/package/tar_input.rb:

  The tar support throws away the gzip header before passing the archive to
  zlib.  MagLev's zlib support expects the gzip header (and, apparently, so
  does Rubinius).  This patch has been submitted and accepted by the
  RubyGems project, so we expect rubygems-1.3.6 to install w/o patches to
  the code.

